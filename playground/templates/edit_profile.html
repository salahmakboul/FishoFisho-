{% extends "main.html" %}
{% block content %}

<div
  style="max-width: 600px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
  <h2 style="margin-bottom: 1.5rem;">Edit Your Profile</h2>

  {% if messages %}
  <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
    {% for message in messages %}
    {{ message }}
    {% endfor %}
  </div>
  {% endif %}

  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Avatar -->
    <div style="text-align: center; margin-bottom: 2rem;">
      <div
        style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; margin: 0 auto 1rem; border: 3px solid #ddd; cursor: pointer;"
        onclick="document.getElementById('id_avatar').click()">
        {% if request.user.userprofile.avatar %}
        <img src="{{ request.user.userprofile.avatar.url }}" alt="Avatar"
          style="width: 100%; height: 100%; object-fit: cover;" id="avatarPreview">
        {% else %}
        <div
          style="width: 100%; height: 100%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
          ðŸ‘¤
        </div>
        {% endif %}
      </div>

      <input type="file" name="avatar" id="id_avatar" accept="image/*" style="display: none;"
        onchange="previewImage(event)">
      <label for="id_avatar" style="cursor: pointer; color: #007bff;">Change Profile Picture</label>
    </div>

    <!-- Bio -->
    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; margin-bottom: 0.5rem; font-weight: bold;">Bio</label>
      <textarea name="bio" rows="4"
        style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">{{ request.user.userprofile.bio }}</textarea>
    </div>

    <!-- Buttons -->
    <div style="display: flex; gap: 1rem;">
      <a href="{% url 'user-profile' pk=request.user.id %}"
        style="padding: 0.75rem 1.5rem; background: #6c757d; color: white; text-decoration: none; border-radius: 4px;">
        Cancel
      </a>
      <button type="submit"
        style="padding: 0.75rem 1.5rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Save Changes
      </button>
    </div>
  </form>
</div>

<script>
  function previewImage(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('avatarPreview') || document.querySelector('img');
    const placeholder = document.querySelector('div[style*="background: #f0f0f0"]');

    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        if (preview) {
          preview.src = e.target.result;
        } else if (placeholder) {
          placeholder.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
        }
      }
      reader.readAsDataURL(file);
    }
  }
</script>

{% endblock %}